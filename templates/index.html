<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard des Cancers</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        /* Design Global */
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            color: #333;
        }

        header {
            background-color: #1f2937;
            color: white;
            padding: 1.5rem;
            text-align: center;
            font-size: 1.8rem;
            font-weight: 600;
        }

        nav {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            background-color: #374151;
            padding: 1rem;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-size: 1rem;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        nav a:hover {
            color: #facc15;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 1rem 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        h2 {
            font-size: 1.5rem;
            color: #1f2937;
            margin-bottom: 1rem;
            border-left: 4px solid #facc15;
            padding-left: 0.5rem;
        }

        .chart-container {
            margin-bottom: 2rem;
        }

        .chart-container h3 {
            text-align: center;
            font-size: 1.2rem;
            color: #4b5563;
        }

        .story {
            margin: 1rem 0;
            padding: 1rem;
            background: #f3f4f6;
            border-left: 4px solid #1f2937;
            border-radius: 8px;
        }

        footer {
            text-align: center;
            background-color: #1f2937;
            color: white;
            padding: 1rem;
            margin-top: 2rem;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
<header>
    Dashboard des Cancers
</header>
<nav>
    <a href="/">Accueil</a>
    <a href="/context">Contexte</a>
    <a href="/ml-model">Modèle ML</a>
</nav>
<div class="container">
    <p>
        Bienvenue sur le dashboard des données de cancer. Ici, nous explorons les statistiques
        sur différents types de cancer en fonction de divers critères : âge, sexe, année de diagnostic, etc.
        Les graphiques suivants vous permettent de mieux comprendre ces données.
    </p>

    <!-- Répartition des cancers par groupe d'âge -->
    <section class="chart-container">
        <h2>Répartition des cancers par groupe d'âge</h2>
        <div id="age-chart"></div>
        <div class="story">
            <p>
                Ce graphique montre comment les cancers sont répartis entre différents groupes d'âge.
                Vous pouvez voir les différences entre les sexes pour chaque groupe.
            </p>
        </div>
    </section>

    <!-- Répartition des types de cancer par groupe d'âge -->
    <section class="chart-container">
        <h2>Répartition des types de cancer par groupe d'âge</h2>
        <div id="cancer-age-chart"></div>
        <div class="story">
            <p>
                Ce graphique montre comment les différents types de cancer sont répartis parmi les groupes d'âge.
                Il met en évidence les types de cancer qui affectent principalement certaines tranches d'âge.
            </p>
        </div>
    </section>

    <section class="chart-container">
        <h2>Âge moyen des patients par année de diagnostic et type de cancer</h2>
        <div id="diagnosis-age-line-chart"></div>
        <div class="story">
            <p>
                Ce graphique montre l'évolution de l'âge moyen des patients pour chaque type de cancer en fonction de
                l'année de diagnostic.
                Il met en évidence les variations d'âge au fil du temps pour différents types de cancer.
            </p>
        </div>
    </section>


    <!-- Évolution du nombre de cas par type de cancer (Line Chart) -->
    <section class="chart-container">
        <h2>Évolution du nombre de cas par type de cancer et sexe</h2>
        <div id="line-chart"></div>
        <div class="story">
            <p>
                Ce graphique montre l'évolution du nombre de cas pour chaque type de cancer au fil des années, avec une
                distinction entre hommes et femmes.
                Cela permet de visualiser les tendances spécifiques à chaque type de cancer.
            </p>
        </div>
    </section>

    <section class="chart-container">
        <h2>Répartition par ethnie et type de cancer</h2>
        <div>
            <select id="ethnicity-dropdown" style="margin-bottom: 20px; padding: 10px; font-size: 16px;">
            </select>
        </div>
        <div id="ethnicity-pie-chart"></div>
        <div class="story">
            <p>
                Ce graphique montre la répartition des types de cancer selon les différentes ethnies.
                Cela permet de comprendre les types de cancer qui prédominent dans chaque groupe ethnique.
            </p>
        </div>

        <section class="chart-container">
            <h2>Répartition du statut vital ou cause de décès par type de cancer</h2>
            <div>
                <select id="cancer-type-dropdown" style="margin-bottom: 20px; padding: 10px; font-size: 16px;">
                </select>
            </div>
            <div id="vital-status-pie-chart" style="width: 100%; max-width: 800px; margin: 0 auto;"></div>
            <div class="story">
                <p>
                    Ce graphique montre la répartition des statuts vitaux (vivant, mort, ou causes spécifiques de décès)
                    pour un type de cancer donné. Utilisez le menu déroulant pour sélectionner un type de cancer et voir
                    les données correspondantes.
                </p>
            </div>
        </section>


    </section>
    <section class="chart-container">
        <h2>Relation entre l'âge et la cause de décès</h2>
        <div id="age-cod-boxplot"></div>
        <div class="story">
            <p>
                Ce graphique montre la distribution des âges pour chaque cause de décès.
                Il permet de visualiser les variations d'âge en fonction des causes spécifiques.
            </p>
        </div>
    </section>

    <section class="chart-container">
        <h2>Répartition du statut vital par ethnie</h2>
        <div id="vital-status-ethnicity-chart"></div>
        <div class="story">
            <p>
                Ce graphique montre la répartition des statuts vitaux (en vie, ou différentes causes de décès) pour
                chaque groupe ethnique.
                Les barres empilées permettent de visualiser la proportion relative de chaque statut dans chaque ethnie.
            </p>
        </div>
    </section>


    <!-- Scripts for Charts -->
    <script>
        // Script for Age Group Chart
        const ageGroupData = {{age_group_data | safe}};

        function renderAgeChart() {
            const traces = ["Male", "Female"].map(gender => ({
                x: ageGroupData.filter(d => d["Sex"] === gender).map(d => d["Age Group"]),
                y: ageGroupData.filter(d => d["Sex"] === gender).map(d => d["Count"]),
                name: gender,
                type: "bar",
            }));

            Plotly.newPlot("age-chart", traces, {
                barmode: "group",
                title: "Répartition par groupe d'âge",
                xaxis: {title: "Groupe d'âge"},
                yaxis: {title: "Nombre de cas"},
            });
        }

        renderAgeChart();

        // Script for Cancer Age Chart
        const cancerAgeData = {{cancer_age_data | safe}};

        function renderCancerAgeChart() {
            const types = [...new Set(cancerAgeData.map(d => d["Type"]))];
            const ageGroups = [...new Set(cancerAgeData.map(d => d["Age Group"]))];

            const traces = types.map(type => ({
                x: cancerAgeData.filter(d => d["Type"] === type).map(d => d["Age Group"]),
                y: cancerAgeData.filter(d => d["Type"] === type).map(d => d["Count"]),
                name: type,
                type: "bar",
            }));

            Plotly.newPlot("cancer-age-chart", traces, {
                barmode: "stack",
                title: "Répartition des types de cancer par groupe d'âge",
                xaxis: {title: "Groupe d'âge"},
                yaxis: {title: "Nombre de cas"},
            });
        }

        renderCancerAgeChart();

        const lineGraphData = {{line_graph_data | safe}};

        function renderDiagnosisAgeLineChart() {
            const cancerTypes = [...new Set(lineGraphData.map(d => d["CancerType"]))]; // Unique cancer types
            const traces = cancerTypes.map(type => ({
                x: lineGraphData.filter(d => d["CancerType"] === type).map(d => d["Year"]), // Years on x-axis
                y: lineGraphData.filter(d => d["CancerType"] === type).map(d => d["AverageAge"]), // Average ages on y-axis
                name: type, // Cancer type as the legend name
                type: "scatter",
                mode: "lines+markers", // Line with markers
            }));

            const layout = {
                title: "Âge moyen des patients par année de diagnostic et type de cancer",
                xaxis: {title: "Année de diagnostic"},
                yaxis: {title: "Âge moyen des patients (années)"},
                legend: {title: {text: "Type de cancer"}},
            };

            Plotly.newPlot("diagnosis-age-line-chart", traces, layout);
        }

        renderDiagnosisAgeLineChart();


        // Script for Line Chart
        const lineChartData = {{line_chart_data | safe}};

        function renderLineChart() {
            const types = [...new Set(lineChartData.map(d => d["Type"]))];
            const traces = types.map(type => {
                const maleData = lineChartData.filter(d => d["Type"] === type && d["Sex"] === "Male");
                const femaleData = lineChartData.filter(d => d["Type"] === type && d["Sex"] === "Female");

                return [
                    {
                        x: maleData.map(d => d["Yeardiag"]),
                        y: maleData.map(d => d["Count"]),
                        name: `${type} (Homme)`,
                        type: "scatter",
                        mode: "lines+markers",
                    },
                    {
                        x: femaleData.map(d => d["Yeardiag"]),
                        y: femaleData.map(d => d["Count"]),
                        name: `${type} (Femme)`,
                        type: "scatter",
                        mode: "lines+markers",
                    },
                ];
            }).flat();

            Plotly.newPlot("line-chart", traces, {
                title: "Évolution du nombre de cas par type de cancer (Homme/Femme)",
                xaxis: {title: "Année de diagnostic"},
                yaxis: {title: "Nombre de cas"},
                legend: {title: "Type de cancer et sexe"},
            });
        }

        renderLineChart();

        const ethnicityCancerData = {{ethnicity_cancer_data | safe}};

        // Populate the dropdown dynamically with unique ethnicities
        const dropdown = document.getElementById("ethnicity-dropdown");
        const races = [...new Set(ethnicityCancerData.map(d => d["Race"]))];
        races.forEach(race => {
            const option = document.createElement("option");
            option.value = race;
            option.textContent = race;
            dropdown.appendChild(option);
        });

        // Function to render the pie chart for a selected ethnicity
        function renderEthnicityPieChart(selectedEthnicity) {
            const filteredData = ethnicityCancerData.filter(d => d["Race"] === selectedEthnicity);
            const pieData = [
                {
                    values: filteredData.map(d => d["Count"]), // Use percentage for the pie slices
                    labels: filteredData.map(d => d["Type"]), // Cancer types as labels
                    type: "pie",
                    hoverinfo: "label+percent", // Tooltip with labels and percentages
                    textinfo: "label+value", // Show label and value inside the chart
                },
            ];

            const layout = {
                title: `Répartition (%) des types de cancer pour ${selectedEthnicity}`,
            };

            Plotly.newPlot("ethnicity-pie-chart", pieData, layout);
        }

        // Set up event listener for dropdown change
        dropdown.addEventListener("change", event => {
            renderEthnicityPieChart(event.target.value);
        });

        // Render the pie chart for the first ethnicity by default
        if (races.length > 0) {
            dropdown.value = races[0]; // Set the default selection to the first ethnicity
            renderEthnicityPieChart(races[0]);
        }

        const vitalStatusData = {{vital_status_data | safe}};

        // Populate the dropdown dynamically with unique cancer types
        const cancerDropdown = document.getElementById("cancer-type-dropdown");
        const cancerTypes = [...new Set(vitalStatusData.map(d => d["Type"]))];
        cancerTypes.forEach(type => {
            const option = document.createElement("option");
            option.value = type;
            option.textContent = type;
            cancerDropdown.appendChild(option);
        });

        // Function to render the pie chart for a selected cancer type
        function renderVitalStatusPieChart(selectedCancerType) {
            const filteredData = vitalStatusData.filter(d => d["Type"] === selectedCancerType);
            const labels = filteredData.map(d => d["COD"] === "Alive" ? "En vie" : d["COD"]);
            const pieData = [
                {
                    values: filteredData.map(d => d["Count"]), // Use counts for the pie slices
                    labels: labels,  // COD (cause of death or "En vie") as labels
                    type: "pie",
                    automargin: true,
                    hoverinfo: "label+percent+value", // Tooltip with labels and percentages
                },
            ];

            const layout = {
                title: `Répartition des statuts vitaux pour le type de cancer : ${selectedCancerType}`,
                height: 700,
                width: 800
            };

            Plotly.newPlot("vital-status-pie-chart", pieData, layout);
        }

        // Set up event listener for dropdown change
        cancerDropdown.addEventListener("change", event => {
            renderVitalStatusPieChart(event.target.value);
        });

        // Render the pie chart for the first cancer type by default
        if (cancerTypes.length > 0) {
            cancerDropdown.value = cancerTypes[0]; // Set the default selection to the first cancer type
            renderVitalStatusPieChart(cancerTypes[0]);
        }

        const boxPlotData = {{box_plot_data | safe}};

        function renderBoxPlot() {
            const causes = [...new Set(boxPlotData.map(d => d["COD"]))];
            const traces = causes.map(cause => ({
                y: boxPlotData.filter(d => d["COD"] === cause).map(d => d["Age"]),
                name: cause,
                type: "box",
                boxpoints: "outliers", // Show individual outliers
                jitter: 0.3, // Spread out points for better visibility
            }));

            const layout = {
                title: "Distribution des âges par cause de décès",
                xaxis: {title: "Cause de décès"},
                yaxis: {title: "Âge (en années)"},
            };

            Plotly.newPlot("age-cod-boxplot", traces, layout);
        }

        renderBoxPlot();

        const vitalStatusEthnicityData = {{vital_status_ethnicity_data | safe}};

        function renderVitalStatusEthnicityChart() {
            const statuses = [...new Set(vitalStatusEthnicityData.map(d => d["COD"]))]; // Unique CODs (vital statuses)
            const traces = statuses.map(status => ({
                x: vitalStatusEthnicityData.filter(d => d["COD"] === status).map(d => d["Race"]), // Ethnicities on x-axis
                y: vitalStatusEthnicityData.filter(d => d["COD"] === status).map(d => d["Percentage"]), // Counts for each status
                name: status === "Alive" ? "En vie" : status, // Replace "Alive" with "En vie"
                type: "bar",
            }));

            const layout = {
                title: "Répartition du statut vital par ethnie",
                barmode: "group",
                xaxis: {title: "Ethnie"},
                yaxis: {title: "Pourcentage"},
                legend: {title: {text: "Statut vital"}},
            };

            Plotly.newPlot("vital-status-ethnicity-chart", traces, layout);
        }

        renderVitalStatusEthnicityChart();
    </script>
</div>
<footer>
    © 2025 Projet Data Viz | Tous droits réservés
</footer>
</body>
</html>
